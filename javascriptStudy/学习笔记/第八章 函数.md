# 第八章 函数

## 概念

* 只定义一次，但是可以反复调用和执行
* 如果函数挂载在一个对象上，作为对象的一个属性，就称为对象的方法
* 可以嵌套在其他函数当中

## 1、函数定义

* function关键字定义，可用于函数定义表达式或者函数声明语句
  * 函数名称标识符，是函数声明的必须部分
  * 函数名后跟（）存放参数，再跟{}作为函数体存放函数运行的执行语句
* 注意：表达式方式定义的函数，函数的名称是可选的
* 函数命名：
  * 注意可读性
  * 通常为动词或以动词为前缀
* 函数声明语句是“被提前”外部脚本或外部函数作用域的顶部，所以可以被写在函数定义前方的语句调用
* printprops（）函数的任务是输出对象各属性的名称和值，返回值始终是undefined
* 嵌套函数：函数可以被包含在其他函数内部

## 2、函数调用

* 定义时不执行，调用执行

* 四种调用方式：

  * 作为函数-函数调用：
    * 通过函数表达式的调用就可以使用
    * 通常不使用this，判断是否是严格模式会用
  * 作为方法-方法调用：
    * 调用了保留在对象内部的函数
    * 通常使用点符号访问，方括号也是可以的
    * 常使用this调用对象内部变量
    * 方法链：当返回值是一个对象时，还可以再调用它的方法，形成一个调用序列
    * this在这种环境下，往往是指向调用它的对象，或者是全局变量（非严格模式）和undefined（严格模式）
  * 作为构造函数-构造函数调用：
    * 创建一个新的空对象，对象继承自函数的prototype属性，构造可以使用this来调用新生成的对象
    * 无参数时圆括号可省略，通常不会有返回值
  * 通过它们的call（）回合apply（）方法-间接调用：
    * 都允许显式调用所需的this
    * 可以指定调用的实参，call（）可以通过自身实参列表赋予，而apply（）需要以数组形式

  

## 3、函数的实参和形参

* 1、可选形参
  * 调用时实参比声明形参要少的话，剩余的形参都会自动设置undefined
  * 可以用“||”来实现if不为undefined的判断，可能为undefined的实参要放在前边
* 2、可变长的实参列表：实参对象
  * 实参个数超过形参个数时，可以用参数对象解决
  * arguments类似数组，0对应第一个参数，以此类推，也有length属性，但不是真正的数组
  * 不定实参函数实参个数不能为0
  * callee和caller属性：
    * 严格模式下对这两个属性的读写操作都会报类型错误
    * callee指代当前正在执行的函数，caller指代调用当前正在执行的函数，caller可以访问调用栈
* 3、将对象属性用作实参
  * 对象储存参数取用的话，就不用担心参数多少以及放入参数的顺序问题
* 4、实参类型
  * 形参传入时是弱类型，没有任何类型检查，只有在内部设置检查

## 4、作为值的函数

* 函数不仅是一种语法，也是值，可以赋予给变量，也可以赋予给对象的属性
* 自定义函数属性：给函数定义属性，但不是全局变量

## 5、作为命名空间的函数

* 定义一个函数作为临时的命名空间，这个命名空间内的定义的变量都不会污染到全局命名空间
* 用圆括号包住函数声明语句的话，就会被解释成函数定义表达式立刻执行，这种函数往往可以不需要命名，是匿名函数
* 有一种常见的用法，代码检测是否出现某个bug，如果有就返回带补丁的函数版本。

## 6、闭包

* 和其他大多数编程语言一样，采用词法作用域，内部状态包含函数的代码逻辑，同时必须引用当前的作用域
* 函数对象可以通过作用域链相互关联起来，函数体内部的变量都可以保存在函数作用域内
* 所有的JavaScript函数都是闭包：它们都是对象，都关联到作用域链。当一个函数嵌套了另一外一个函数，外部函数将嵌套的函数对象作为返回值返回的时候往往会发生闭包指向的作用域链和定义函数的作用域链不是同一个的情况
* 函数定义时的作用域链到函数执行时依然有效，函数内部的局部变量在函数返回后也依然存在
* 词法作用域规则：
* 闭包的实现：
  * 调用函数时，会创建新的对象加入作用域链，返回值后删除该对象
  * 如果有嵌套函数，每个嵌套函数都有各自对应的作用域链，它的作用域链会随着返回值储存在某个属性而不是垃圾回收
* 总的来说就是把嵌套的函数，通过返回值的形式与某个变量联系起来，每个变量关联的嵌套函数都是独立的
* 同一作用域链下的闭包，共享同样的私有变量以及其他变量
* 不使用返回值来处理时，可以与函数参数结合，临时通过字符串组合的形式创建方法，并将其赋予某个对象
* 两种方法均可以创建多个闭包，但返回值形式要结合到一个对象内才可以

## 7、函数属性、方法和构造函数

* 概念：函数是值，typeof返回的是“function”
* 1、length属性
  * arguments.length表示传入函数的实参个数
  * arguments.callee.length表示期望传入的实参个数
* 2、prototype属性
  * 指向对象引用原型
* 3、call（）方法和apply（）方法
  * 可以看做是某个对象的方法，间接调用函数
  * 严格模式下，第一个实参会变成this的值
  * call（）：第一个实参代表调用函数，后续实参代表调用该函数传入的实参
  * apply（）：与call（）相似，但后续实参都是放在一个数组内部的
* 4、bind（）方法
  * 将函数绑定至某个对象
  * 通过f调用bind传入一个对象o，返回一个函数调用o中的方法f
  * 可以绑定this，绑定这个的bind（）方法存放在Function.prototype.bind
* 5、toString（）方法
  * 函数的toString（）方法大多数情况是返回完整源码，内置函数往往返回“[native code]”的字符串
* 6、Function（）构造函数
  * 不管是定义语句，还是直接量创建，都需要经过function关键字。也可以通过构造函数Function（）来创建。
  * 可以传入任意数量的实参，最后一个实参就是函数体
  * 注意：
    * Function（）允许JavaScript在运行时动态的创建并编译函数
    * 每次调用Function（）构造函数都会解析函数体，创建新的函数对象
    * 它创建的函数并不是使用词法作用域，总是会在顶层函数执行
* 7、可调用的对象
  * 可调用的对象不一定是函数，所有的函数都是可调用的
  * 可调用对象在两个JavaScript实现中不算函数
  * Window.alert()和Document.getElementId()使用可调用的宿主对象，而不是内置函数对象
  * 一个常见的可调用对象就是RegExp（）

## 8、函数式编程

* 1、函数处理数组
  * 计算平均值和标准差这些数值时，使用map（）和reduce（）能够简化计算
* 2、高阶函数
  * 操作函数的函数，它接收一个或多个函数作为参数，并返回一个新函数
* 3、不完全函数
  * bind（）方法只是将参数放在左侧，传入的实参都是放在传入原始函数的实参列表开始的位置，但有时可以根据要求放在右侧
* 4、记忆
  * 上一次计算的结果可以被记录缓存下来，其实就是将结果放入缓存对象中返回

